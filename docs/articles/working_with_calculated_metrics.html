<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analysis Workflows And Calculated Metrics • adobeanalyticsr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Analysis Workflows And Calculated Metrics">
<meta property="og:description" content="adobeanalyticsr">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-06XDF7JD6E"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-06XDF7JD6E');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">adobeanalyticsr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/working_with_calculated_metrics.html">Analysis Workflows And Calculated Metrics</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/benrwoodard/adobeanalyticsr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Analysis Workflows And Calculated Metrics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/benrwoodard/adobeanalyticsr/blob/HEAD/vignettes/working_with_calculated_metrics.Rmd" class="external-link"><code>vignettes/working_with_calculated_metrics.Rmd</code></a></small>
      <div class="hidden name"><code>working_with_calculated_metrics.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="a-little-housekeeping">A little housekeeping<a class="anchor" aria-label="anchor" href="#a-little-housekeeping"></a>
</h2>
<p>This vignette uses the Adobe Analytics University Student Access
account to show how to work with calculated metrics using R and the API.
If you do not have access to the account, you can easily get it by going
to the free LinkedIn Learning course, <a href="https://www.linkedin.com/learning/adobe-analytics-essential-training/solving-business-challenges-with-adobe-analytics" class="external-link">“Adobe
Analytics Essential training”</a>, and registering for access.</p>
<p>If you haven’t yet taken the course, it is well worth your time. Eric
Matisoff does a great job walking through all the different amazing
parts of Adobe Analytics, especially Analysis Workspace. Specifically,
check out the third section of the first chapter to see a quick overview
of the calculated metrics builder user interface in action.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>I won’t be going into the any detail around authenticate in this
article so if you are needing more help with that, make sure to check
out the “Getting Started” vignette. With all that being said, the</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load the packages needed</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/benrwoodard/adobeanalyticsr" class="external-link">adobeanalyticsr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span> <span class="co">## needed for some of the data wrangling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/jsonlite" class="external-link">jsonlite</a></span><span class="op">)</span> <span class="co">## Will help in visualizing calculated metris definitions</span></span>
<span></span>
<span><span class="fu"><a href="../reference/aw_auth.html">aw_auth</a></span><span class="op">(</span><span class="st">'oauth'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Successfully authenticated with OAuth</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Check to make sure you have been logged into the correct account profile</span></span>
<span><span class="fu"><a href="../reference/get_me.html">get_me</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   globalCompanyId                               companyName</span></span>
<span><span class="co">## 1       adobea8cf Adobe Analytics University Student Access</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">company_id</span> <span class="op">&lt;-</span> <span class="st">'adobea8cf'</span></span>
<span><span class="va">rsid</span> <span class="op">&lt;-</span> <span class="st">'igeo1xxpnwcidadobepm'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="retrieve-multiple-calculated-metrics">Retrieve multiple calculated metrics<a class="anchor" aria-label="anchor" href="#retrieve-multiple-calculated-metrics"></a>
</h2>
<p>The following example shows a calculated metrics request for a
response localized in US English, limited to the first page, and with
the size of ten responses per page.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aw_get_calculatedmetrics.html">aw_get_calculatedmetrics</a></span><span class="op">(</span>includeType <span class="op">=</span> <span class="st">'all'</span>, </span>
<span>                                rsids <span class="op">=</span> <span class="va">rsid</span>, </span>
<span>                                company_id <span class="op">=</span> <span class="va">company_id</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cms</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="13%">
<col width="23%">
<col width="20%">
<col width="18%">
<col width="6%">
<col width="5%">
<col width="6%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">rsid</th>
<th align="left">id</th>
<th align="left">name</th>
<th align="left">description</th>
<th align="left">owner</th>
<th align="left">polarity</th>
<th align="right">precision</th>
<th align="left">type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">igeo1xxpnwcidadobepm</td>
<td align="left">cm300010142_612a3e49262f3f1415082cee</td>
<td align="left">Page</td>
<td align="left"></td>
<td align="left">200456743</td>
<td align="left">positive</td>
<td align="right">0</td>
<td align="left">decimal</td>
</tr>
<tr class="even">
<td align="left">igeo1xxpnwcidadobepm</td>
<td align="left">cm300010142_61336bad44b1bd4f51a9e2ae</td>
<td align="left">Bounce Rate (Bounces / Visits)</td>
<td align="left"></td>
<td align="left">200456743</td>
<td align="left">positive</td>
<td align="right">1</td>
<td align="left">percent</td>
</tr>
<tr class="odd">
<td align="left">igeo1xxpnwcidadobepm</td>
<td align="left">cm300010142_61336f20c7e6035b10558588</td>
<td align="left">Pages Count</td>
<td align="left"></td>
<td align="left">200456743</td>
<td align="left">positive</td>
<td align="right">0</td>
<td align="left">decimal</td>
</tr>
<tr class="even">
<td align="left">igeo1xxpnwcidadobepm</td>
<td align="left">cm300010142_61416ee549ff383abc37c6ab</td>
<td align="left">cart convert 1</td>
<td align="left">cart checkouts per page view</td>
<td align="left">200483715</td>
<td align="left">positive</td>
<td align="right">4</td>
<td align="left">decimal</td>
</tr>
<tr class="odd">
<td align="left">igeo1xxpnwcidadobepm</td>
<td align="left">cm300010142_614179ec49ff383abc37c6c3</td>
<td align="left">Conversions</td>
<td align="left"></td>
<td align="left">200484198</td>
<td align="left">positive</td>
<td align="right">0</td>
<td align="left">decimal</td>
</tr>
<tr class="even">
<td align="left">igeo1xxpnwcidadobepm</td>
<td align="left">cm300010142_614a8d494ba44e49bb383be5</td>
<td align="left">cart convert 1</td>
<td align="left"></td>
<td align="left">200484193</td>
<td align="left">positive</td>
<td align="right">4</td>
<td align="left">decimal</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="retrieving-a-single-calculated-metric">Retrieving a single calculated metric<a class="anchor" aria-label="anchor" href="#retrieving-a-single-calculated-metric"></a>
</h2>
<p>To retrieve a single calculated metric, include its id in the
request.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aw_get_calculatedmetrics.html">aw_get_calculatedmetrics</a></span><span class="op">(</span>filterByIds <span class="op">=</span> <span class="va">cms</span><span class="op">$</span><span class="va">id</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="co">#add the calculated metric</span></span>
<span>                               company_id <span class="op">=</span> <span class="va">company_id</span>,</span>
<span>                               rsids <span class="op">=</span> <span class="va">rsid</span>, </span>
<span>                               expansion <span class="op">=</span> <span class="st">'definition'</span> <span class="co">#use the expansion argument to see the definition</span></span>
<span>                               <span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">cm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in `[&lt;-.data.frame`(`*tmp*`, , j, value = structure(list(formula.func =</span></span>
<span><span class="co">## structure("visualization-group", class = "AsIs"), : provided 10 variables to</span></span>
<span><span class="co">## replace 1 variables</span></span></code></pre>
<table style="width:100%;" class="table">
<colgroup>
<col width="15%">
<col width="28%">
<col width="3%">
<col width="9%">
<col width="7%">
<col width="6%">
<col width="7%">
<col width="6%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">rsid</th>
<th align="left">id</th>
<th align="left">name</th>
<th align="left">description</th>
<th align="left">owner</th>
<th align="left">polarity</th>
<th align="right">precision</th>
<th align="left">type</th>
<th align="left">definition</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">igeo1xxpnwcidadobepm</td>
<td align="left">cm300010142_612a3e49262f3f1415082cee</td>
<td align="left">Page</td>
<td align="left"></td>
<td align="left">200456743</td>
<td align="left">positive</td>
<td align="right">0</td>
<td align="left">decimal</td>
<td align="left">visualization-group</td>
</tr></tbody>
</table>
</div>
<div class="section level2">
<h2 id="calculated-metric-management-functions">Calculated metric management functions<a class="anchor" aria-label="anchor" href="#calculated-metric-management-functions"></a>
</h2>
<p>Calculated Metrics are comprised of several different mathematical
functions that work on available metrics for a given report suite.</p>
<div class="section level3">
<h3 id="get-all-functions">Get all functions<a class="anchor" aria-label="anchor" href="#get-all-functions"></a>
</h3>
<p>Returns a full list of calculated metric functions that the user can
access.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_functions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cm_functions.html">get_cm_functions</a></span><span class="op">(</span>company_id <span class="op">=</span> <span class="va">company_id</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">all_functions</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in `[&lt;-.data.frame`(`*tmp*`, , j, value = structure(list(func =</span></span>
<span><span class="co">## structure(c("calc-metric", : provided 232 variables to replace 1 variables</span></span></code></pre>
<table class="table">
<colgroup>
<col width="12%">
<col width="4%">
<col width="6%">
<col width="17%">
<col width="52%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">id</th>
<th align="left">category</th>
<th align="left">persistable</th>
<th align="left">name</th>
<th align="left">description</th>
<th align="left">definition</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">col-sum</td>
<td align="left">basic</td>
<td align="left">TRUE</td>
<td align="left">Column Sum</td>
<td align="left">Adds all of the numeric values for a metric within a
column (across the elements of a dimension).</td>
<td align="left">calc-metric</td>
</tr>
<tr class="even">
<td align="left">_new-lift-functional</td>
<td align="left">internal</td>
<td align="left">FALSE</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">calc-metric</td>
</tr>
<tr class="odd">
<td align="left">_lift-cumul-avg-impl</td>
<td align="left">internal</td>
<td align="left">FALSE</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">calc-metric</td>
</tr>
<tr class="even">
<td align="left">_waskr-N-control</td>
<td align="left">internal</td>
<td align="left">FALSE</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">calc-metric</td>
</tr>
<tr class="odd">
<td align="left">ls-intercept-quadratic</td>
<td align="left">advanced</td>
<td align="left">TRUE</td>
<td align="left">Quadratic regression: Intercept</td>
<td align="left">Quadratic regression: Y = ( a + b X ) ^ 2, Returns
a.</td>
<td align="left">calc-metric</td>
</tr>
<tr class="even">
<td align="left">_chi2-test-stat</td>
<td align="left">internal</td>
<td align="left">FALSE</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">calc-metric</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="create-a-calculated-metric">Create a calculated metric<a class="anchor" aria-label="anchor" href="#create-a-calculated-metric"></a>
</h3>
<p>The process of creating a calculated metric has been designed in a
modular way to enable the systematic approach to building and
maintaining complex calculated metrics in the most efficient way. The
goal is to enhance analysis and data science workflows. The essential
elements of a calculated metric are: function, formula, build. The
following code chunks will illustrate the basics of interacting with
each element.</p>
<div class="section level4">
<h4 id="create-a-function-object">Create a function object<a class="anchor" aria-label="anchor" href="#create-a-function-object"></a>
</h4>
<p>Calculated Metrics are comprised of several different mathematical
functions that work on available metrics for a given report suite. See
the <a href="https://experienceleague.adobe.com/docs/analytics/components/calculated-metrics/calcmetrics-reference/cm-functions.html?lang=en" class="external-link">functions
documentation</a> for more information on available functions.</p>
<p>Currently the package only supports 2 types of functions:</p>
<ol style="list-style-type: decimal">
<li>Any function that take a single metric</li>
</ol>
<ul>
<li>Examples of these functions include
<code>Absolute Value (Row)</code> and <code>Column Maximum</code>. Both
of which apply a function on a single metric. For a full list make sure
to see the <a href="https://experienceleague.adobe.com/docs/analytics/components/calculated-metrics/calcmetrics-reference/cm-functions.html?lang=en" class="external-link">functions
documentation</a>.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>The <code>Approximate Count Distinct (dimension)</code>
function</li>
</ol>
<ul>
<li>Returns the approximated distinct count of dimension items for the
selected dimension. The function uses the HyperLogLog (HLL) method of
approximating distinct counts. It is configured to guarantee the value
is within 5% of the actual value 95% of the time.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">cm_function</span></span>
<span></span>
<span><span class="va">cm_func</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cm_function.html">cm_function</a></span><span class="op">(</span></span>
<span>  func <span class="op">=</span> <span class="st">"col-sum"</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"visits"</span>,</span>
<span>  seg_filter <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rsid <span class="op">=</span> <span class="va">rsid</span>,</span>
<span>  company_id <span class="op">=</span> <span class="va">company_id</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">cm_func</span>, pretty <span class="op">=</span> <span class="cn">T</span>, auto_unbox <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## {</span></span>
<span><span class="co">##   "func": "col-sum",</span></span>
<span><span class="co">##   "description": "Column Sum",</span></span>
<span><span class="co">##   "col": {</span></span>
<span><span class="co">##     "func": "metric",</span></span>
<span><span class="co">##     "name": "metrics/visits",</span></span>
<span><span class="co">##     "description": "Visits"</span></span>
<span><span class="co">##   }</span></span>
<span><span class="co">## }</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="create-a-formula-object">Create a formula object<a class="anchor" aria-label="anchor" href="#create-a-formula-object"></a>
</h4>
<p>A calculated metric formula takes to metric objects and applies an
operator on them. You can nest formula or function objects within
formulas to create complex operational containers. Keep in mind, unlike
segment containers, these containers function like a math expression and
determine the order of operations.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">cm_formula</span></span>
<span></span>
<span><span class="va">cm_form</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cm_formula.html">cm_formula</a></span><span class="op">(</span></span>
<span>  operator <span class="op">=</span> <span class="st">'divide'</span>,</span>
<span>  metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cm_func</span>, <span class="st">"singlepagevisits"</span><span class="op">)</span>,</span>
<span>  seg_filters <span class="op">=</span> <span class="cn">NA</span>, <span class="co">#add segment filters for each metric if needed</span></span>
<span>  rsid <span class="op">=</span> <span class="va">rsid</span>,</span>
<span>  company_id <span class="op">=</span> <span class="va">company_id</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">cm_form</span>, pretty <span class="op">=</span> <span class="cn">T</span>, auto_unbox <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## {</span></span>
<span><span class="co">##   "func": "divide",</span></span>
<span><span class="co">##   "col1": {</span></span>
<span><span class="co">##     "func": "col-sum",</span></span>
<span><span class="co">##     "description": "Column Sum",</span></span>
<span><span class="co">##     "col": {</span></span>
<span><span class="co">##       "func": "metric",</span></span>
<span><span class="co">##       "name": "metrics/visits",</span></span>
<span><span class="co">##       "description": "Visits"</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##   },</span></span>
<span><span class="co">##   "col2": {</span></span>
<span><span class="co">##     "func": "metric",</span></span>
<span><span class="co">##     "name": "metrics/singlepagevisits",</span></span>
<span><span class="co">##     "description": "Single Page Visits"</span></span>
<span><span class="co">##   }</span></span>
<span><span class="co">## }</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="create-a-calculated-metric-object">Create a calculated metric object<a class="anchor" aria-label="anchor" href="#create-a-calculated-metric-object"></a>
</h4>
<p>Using the <code>cm_build</code> function gives the ability to create
and validate simple and complex calculated metrics. If you are familiar
with the calculated metrics user interface you should be able to quickly
recognize what each aspect of the function arguments refer to but fo
those who are less familiar the <a href="https://experienceleague.adobe.com/docs/analytics/components/calculated-metrics/calcmetric-workflow/cm-build-metrics.html?lang=en#areas-of-the-calculated-metrics-builder" class="external-link">calculated
metrics builder documentation</a> may be of great use.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">cm_build</span></span>
<span></span>
<span><span class="va">cm_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cm_build.html">cm_build</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">'Test Calculated Metric'</span>,</span>
<span>  description <span class="op">=</span> <span class="st">'Test cm description'</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">cm_form</span>,</span>
<span>  seg_filter <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  polarity <span class="op">=</span> <span class="st">"positive"</span>,</span>
<span>  precision <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"decimal"</span>,</span>
<span>  create_cm <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#should this be created in the UI</span></span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  rsid <span class="op">=</span> <span class="va">rsid</span>,</span>
<span>  company_id <span class="op">=</span> <span class="va">company_id</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cm_obj</span></span></code></pre></div>
<pre><code><span><span class="co">## {"rsid":"igeo1xxpnwcidadobepm","name":"Test Calculated Metric","description":"Test cm description","definition":{"formula":{"func":"divide","col1":{"func":"col-sum","description":"Column Sum","col":{"func":"metric","name":"metrics/visits","description":"Visits"}},"col2":{"func":"metric","name":"metrics/singlepagevisits","description":"Single Page Visits"}},"version":[1,0,0],"func":"calc-metric"},"polarity":"positive","precision":0,"type":"decimal"}</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="validate-a-calculated-metric-object">Validate a calculated metric object<a class="anchor" aria-label="anchor" href="#validate-a-calculated-metric-object"></a>
</h3>
<p>Because report suites can have different configurations, dimensions,
or metrics, a calculated metric that is valid in one report suite may
not be valid in another. To determine which calculated metric to use in
different report suites, and why it may or may not be available, you can
use the cm_validate. This endpoint allows you to POST a definition along
with a target report suite id. The validate endpoint responds with
compatibility information on the calculated metric.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">cm_val</span></span>
<span></span>
<span><span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cm_val.html">cm_val</a></span><span class="op">(</span><span class="va">cm_obj</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cm</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "The calculated metric definition IS VALID"</span></span></code></pre>
<p>Once yo determine make we can create the new calculated metric in the
UI by setting the argument <code>create_cm = TRUE</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#create the calculated metric in the UI</span></span>
<span><span class="va">cm_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cm_build.html">cm_build</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">'Test Calculated Metric'</span>,</span>
<span>  description <span class="op">=</span> <span class="st">'Test cm description'</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">cm_form</span>,</span>
<span>  seg_filter <span class="op">=</span> <span class="cn">NULL</span>, <span class="co">#include an overall segment filter</span></span>
<span>  polarity <span class="op">=</span> <span class="st">"positive"</span>,</span>
<span>  precision <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"decimal"</span>,</span>
<span>  create_cm <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co">#should this be created in the UI</span></span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  rsid <span class="op">=</span> <span class="va">rsid</span>,</span>
<span>  company_id <span class="op">=</span> <span class="va">company_id</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cm_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aw_get_calculatedmetrics.html">aw_get_calculatedmetrics</a></span><span class="op">(</span>filterByIds <span class="op">=</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">cm_obj</span><span class="op">)</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">cm_var</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="15%">
<col width="26%">
<col width="16%">
<col width="14%">
<col width="7%">
<col width="6%">
<col width="7%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">rsid</th>
<th align="left">id</th>
<th align="left">name</th>
<th align="left">description</th>
<th align="left">owner</th>
<th align="left">polarity</th>
<th align="right">precision</th>
<th align="left">type</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">igeo1xxpnwcidadobepm</td>
<td align="left">cm300010142_652d78a3de0e706af61565ed</td>
<td align="left">Test Calculated Metric</td>
<td align="left">Test cm description</td>
<td align="left">200654087</td>
<td align="left">positive</td>
<td align="right">0</td>
<td align="left">decimal</td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="update-a-calculated-metric">Update a calculated metric<a class="anchor" aria-label="anchor" href="#update-a-calculated-metric"></a>
</h3>
<p>To update the name or description it is as simple as adding them
within a list function of the <code>updates</code> argument.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">cm_update</span></span>
<span></span>
<span><span class="va">cm_updated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cm_update.html">cm_update</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="va">cm_var</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  updates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"new name"</span>,</span>
<span>                 description <span class="op">=</span> <span class="st">"this is a new description"</span><span class="op">)</span>,</span>
<span>  locale <span class="op">=</span> <span class="st">"en_US"</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  company_id <span class="op">=</span> <span class="va">company_id</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Name Change</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`old name` <span class="op">=</span> <span class="va">cm_var</span><span class="op">$</span><span class="va">name</span>,`new name` <span class="op">=</span> <span class="va">cm_updated</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 old name                 new name </span></span>
<span><span class="co">## "Test Calculated Metric"               "new name"</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Description Change</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`old description` <span class="op">=</span> <span class="va">cm_var</span><span class="op">$</span><span class="va">description</span>,`new description` <span class="op">=</span> <span class="va">cm_updated</span><span class="op">$</span><span class="va">description</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             old description             new description </span></span>
<span><span class="co">##       "Test cm description" "this is a new description"</span></span></code></pre>
<p>For updating an existing calculated metrics within the definition
there is a more complex solution that needs to be done.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cm_updated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aw_get_calculatedmetrics.html">aw_get_calculatedmetrics</a></span><span class="op">(</span>filterByIds <span class="op">=</span> <span class="va">cm_updated</span><span class="op">$</span><span class="va">id</span>, expansion <span class="op">=</span> <span class="st">'definition'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#change the col1 values to reflect a new function `col-sum`</span></span>
<span><span class="va">cm_updated</span><span class="op">$</span><span class="va">definition</span><span class="op">$</span><span class="va">formula</span><span class="op">$</span><span class="va">col1</span><span class="op">$</span><span class="va">func</span> <span class="op">&lt;-</span> <span class="st">'mean'</span></span>
<span><span class="va">cm_updated</span><span class="op">$</span><span class="va">definition</span><span class="op">$</span><span class="va">formula</span><span class="op">$</span><span class="va">col1</span><span class="op">$</span><span class="va">description</span> <span class="op">&lt;-</span> <span class="st">'Mean'</span></span>
<span><span class="va">cm_updated</span><span class="op">$</span><span class="va">definition</span><span class="op">$</span><span class="va">formula</span><span class="op">$</span><span class="va">col1</span><span class="op">$</span><span class="va">`include-zeros`</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span></span>
<span><span class="va">cm_update_complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cm_update.html">cm_update</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="va">cm_updated</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  updates <span class="op">=</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/unbox.html" class="external-link">unbox</a></span><span class="op">(</span><span class="va">cm_updated</span><span class="op">)</span>,</span>
<span>  locale <span class="op">=</span> <span class="st">"en_US"</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  company_id <span class="op">=</span> <span class="va">company_id</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cm_update_complete</span><span class="op">$</span><span class="va">definition</span><span class="op">$</span><span class="va">formula</span><span class="op">$</span><span class="va">col1</span><span class="op">$</span><span class="va">func</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "mean"</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cm_update_complete</span><span class="op">$</span><span class="va">definition</span><span class="op">$</span><span class="va">formula</span><span class="op">$</span><span class="va">col1</span><span class="op">$</span><span class="va">description</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Mean"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="copy-a-calculated-metric">Copy a Calculated Metric<a class="anchor" aria-label="anchor" href="#copy-a-calculated-metric"></a>
</h3>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cm_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aw_get_calculatedmetrics.html">aw_get_calculatedmetrics</a></span><span class="op">(</span>filterByIds <span class="op">=</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">cm_obj</span><span class="op">)</span><span class="op">$</span><span class="va">id</span>, </span>
<span>                                   expansion <span class="op">=</span> <span class="st">'definition'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">cm_var</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [{"rsid":"igeo1xxpnwcidadobepm","id":"cm300010142_652d78a3de0e706af61565ed","name":"new name","description":"this is a new description","owner":{"id":200654087},"polarity":"positive","precision":0,"type":"decimal","definition":{"formula":{"func":"divide","col1":{"func":"mean","description":"Mean","col":{"func":"metric","name":"metrics/visits","description":"Visits"},"include-zeros":false},"col2":{"func":"metric","name":"metrics/singlepagevisits","description":"Single Page Visits"}},"func":"calc-metric","version":[1,0,0]}}]</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">copy_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cm_copy.html">cm_copy</a></span><span class="op">(</span>cm_id <span class="op">=</span> <span class="va">cm_var</span><span class="op">$</span><span class="va">id</span>, </span>
<span>                    name <span class="op">=</span> <span class="st">'Here I copy the cm'</span>, </span>
<span>                    description <span class="op">=</span> <span class="st">'I want to add a new description'</span>, </span>
<span>                    polarity <span class="op">=</span> <span class="st">'negative'</span>, </span>
<span>                    precision <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                    type <span class="op">=</span> <span class="st">'percent'</span>,</span>
<span>                    create_cm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">copy_res</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "{\"rsid\":\"igeo1xxpnwcidadobepm\",\"id\":\"cm300010142_652d78a7ac32410bb14ad76d\",\"name\":\"Here I copy the cm\",\"description\":\"I want to add a new description\",\"isDeleted\":false,\"migratedIds\":[],\"internal\":false,\"owner\":{\"id\":200654087},\"hidden\":false,\"componentType\":\"calculatedMetric\",\"polarity\":\"negative\",\"precision\":2,\"type\":\"percent\",\"definition\":{\"formula\":{\"func\":\"divide\",\"col1\":{\"func\":\"mean\",\"description\":\"Mean\",\"col\":{\"func\":\"metric\",\"name\":\"metrics/visits\",\"description\":\"Visits\"},\"include-zeros\":false},\"col2\":{\"func\":\"metric\",\"name\":\"metrics/singlepagevisits\",\"description\":\"Single Page Visits\"}},\"func\":\"calc-metric\",\"version\":[1,0,0]},\"compatibility\":{\"identityMetrics\":[{\"identity\":\"metrics/visits\"},{\"identity\":\"metrics/singlepagevisits\"}],\"functions\":[\"mean\",\"divide\"],\"validator_version\":\"1.0.0\",\"supported_products\":[\"oberon\"],\"supported_schema\":[\"schema_oberon\",\"schema_frag\"]},\"legacyId\":\"\",\"categories\":[\"Calculated Metrics\"],\"modified\":\"2023-10-16T17:53:43Z\"}"</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cm_val.html">cm_val</a></span><span class="op">(</span><span class="va">copy_res</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "The calculated metric definition IS VALID"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="delete-calculated-metrics">Delete calculated metrics<a class="anchor" aria-label="anchor" href="#delete-calculated-metrics"></a>
</h3>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">cm_delete</span></span>
<span></span>
<span><span class="va">deleted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cm_delete.html">cm_delete</a></span><span class="op">(</span></span>
<span>  cm_id <span class="op">=</span> <span class="va">cm_var</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  warn <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  locale <span class="op">=</span> <span class="st">"en_US"</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  rsid <span class="op">=</span> <span class="va">rsid</span>,</span>
<span>  company_id <span class="op">=</span> <span class="va">company_id</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## success: cm300010142_652d78a3de0e706af61565ed has been deleted</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The set of calculated metric functions are setup to enable the end
user to easily incorporate calculated metrics into the analysis and data
science workflows without needing to interact with the UI. At the same
time, the application of integrating the API in workflows enables a
broader set of analytics users to incorporate the results and ongoing
analysis in the powerful and versatile Analysis Workspace. Make sure to
add an issue in Github or add a pull request if you find additional
opportunities of development that would enhance the ability to analyze
and communicate the results using calculated metrics in your
workflows.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="http://github.com/benrwoodard" class="external-link">Ben Woodard</a>, Tim Wilson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
